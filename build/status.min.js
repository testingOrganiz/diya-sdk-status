!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],2:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],3:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],4:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){base=" [Function"+(value.name?": "+value.name:"")+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(recurseTimes<0)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;return output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(/%[sdj%]/g,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:1,inherits:2}],5:[function(require,module,exports){"use strict";!function(){function Status(selector){return this.selector=selector,this._coder=selector.encode(),this.subscriptions=[],this.robotModel=[],this._robotModelInit=!1,this.dataConfig={criteria:{time:{beg:null,end:null,range:null},robot:null},operator:"last",parts:null,status:null},this}if("undefined"==typeof window)var Promise=require("bluebird");else var Promise=window.Promise;var DiyaSelector=d1.DiyaSelector,Logger=(require("util"),{log:function(message){console.log(message)},error:function(message){console.error(message)}});Status.prototype.getRobotModel=function(){return this.robotModel},Status.prototype.DataConfig=function(newDataConfig){return newDataConfig?(this.dataConfig=newDataConfig,this):this.dataConfig},Status.prototype.DataOperator=function(newOperator){return newOperator?(this.dataConfig.operator=newOperator,this):this.dataConfig.operator},Status.prototype.DataSampling=function(numSamples){return numSamples?(this.dataConfig.sampling=numSamples,this):this.dataConfig.sampling},Status.prototype.DataTime=function(newTimeBeg,newTimeEnd,newRange){return newTimeBeg||newTimeEnd||newRange?(this.dataConfig.criteria.time.beg=newTimeBeg.getTime(),this.dataConfig.criteria.time.end=newTimeEnd.getTime(),this.dataConfig.criteria.time.range=newRange,this):{beg:new Date(this.dataConfig.criteria.time.beg),end:new Date(this.dataConfig.criteria.time.end),range:new Date(this.dataConfig.criteria.time.range)}},Status.prototype.DataRobotIds=function(robotIds){return robotIds?(this.dataConfig.criteria.robot=robotIds,this):this.dataConfig.criteria.robot},Status.prototype.DataPlaceIds=function(placeIds){return placeIds?(this.dataConfig.criteria.placeId=placeIds,this):this.dataConfig.criteria.place},Status.prototype.getDataByName=function(sensorNames){var data=[];for(var n in sensorNames)data.push(this.dataModel[sensorNames[n]]);return data},Status.prototype.watch=function(robotNames,callback){var _this=this;this.selector.setMaxListeners(0),this.selector._connection.setMaxListeners(0);var sendData=[],robotIds=[];return Promise.try(function(_){_this.selector.request({service:"status",func:"GetManagedObjects",obj:{interface:"org.freedesktop.DBus.ObjectManager"}},function(peerId,err,objData){var robotName="",robotId=1;for(var objectPath in objData)if(null!=objData[objectPath]["fr.partnering.Status.Robot"]&&(robotName=objData[objectPath]["fr.partnering.Status.Robot"].RobotName,robotId=objData[objectPath]["fr.partnering.Status.Robot"].RobotId,robotIds[robotName]=robotId,_this.getAllStatuses(robotName,function(model){callback(model)})),null!=objData[objectPath]["fr.partnering.Status.Part"]){var subs=_this.selector.subscribe({service:"status",func:"StatusChanged",obj:{interface:"fr.partnering.Status.Part",path:objectPath},data:robotNames},function(peerId,err,data){null!=err?Logger.error("StatusSubscribe:"+err):(sendData[0]=data,_this._getRobotModelFromRecv2(sendData,robotId,robotName),"function"==typeof callback&&callback(_this.robotModel))});_this.subscriptions.push(subs)}})}).catch(function(err){Logger.error(err)})},Status.prototype.closeSubscriptions=function(){for(var i in this.subscriptions)this.subscriptions[i].close();this.subscriptions=[],this.robotModel=[]},Status.prototype.getData=function(callback,dataConfig){var _this2=this,dataModel={};return Promise.try(function(_){null!=dataConfig&&_this2.DataConfig(dataConfig),_this2.selector.request({service:"status",func:"DataRequest",data:{type:"splReq",dataConfig:_this2.dataConfig}},function(dnId,err,data){return null!=err?void Logger.error("["+_this2.dataConfig.sensors+"] Recv err: "+JSON.stringify(err)):null!=data.header.error?(Logger.error("UpdateData:\n"+JSON.stringify(data.header.reqConfig)),void Logger.error("Data request failed ("+data.header.error.st+"): "+data.header.error.msg)):(dataModel=_this2._getDataModelFromRecv(data),Logger.log(_this2.getDataModel()),void(callback=callback.bind(_this2))(dataModel))})}).catch(function(err){Logger.error(err)})},Status.prototype._getRobotModelFromRecv2=function(data,robotId,robotName){var _this3=this;null==this.robotModel&&(this.robotModel=[]),null!=this.robotModel[robotId]&&(this.robotModel[robotId].parts={}),null==this.robotModel[robotId]&&(this.robotModel[robotId]={}),this.robotModel[robotId]={robot:{name:robotName}},this.robotModel[robotId].parts={};var rParts=this.robotModel[robotId].parts;data.forEach(function(d){var partId=d[0],category=d[1],partName=d[2],label=d[3],time=d[4],code=d[5],codeRef=d[6],msg=d[7],critLevel=d[8],description=d[9];null==rParts[partId]&&(rParts[partId]={}),rParts[partId].category=category,rParts[partId].name=partName.toLowerCase(),rParts[partId].label=label,null==rParts[partId].errorList&&(rParts[partId].errorList={}),null==rParts[partId].errorList[codeRef]&&(rParts[partId].errorList[codeRef]={msg:msg,critLevel:critLevel,description:description});var evts_tmp={time:_this3._coder.from(time),code:_this3._coder.from(code),codeRef:_this3._coder.from(codeRef)};if(Array.isArray(evts_tmp.code)||Array.isArray(evts_tmp.time)||Array.isArray(evts_tmp.codeRef))if(evts_tmp.code.length===evts_tmp.codeRef.length&&evts_tmp.code.length===evts_tmp.time.length){rParts[partId].evts=[];for(var i=0;i<evts_tmp.code.length;i++)rParts[partId].evts.push({time:evts_tmp.time[i],code:evts_tmp.code[i],codeRef:evts_tmp.codeRef[i]})}else Logger.error("Status:Inconsistant lengths of buffers (time/code/codeRef)");else rParts[partId].evts=[{time:evts_tmp.time,code:evts_tmp.code,codeRef:evts_tmp.codeRef}]})},DiyaSelector.prototype.Status=function(){return new Status(this)},DiyaSelector.prototype.setStatus=function(robotName,partName,code,source,callback){var _this4=this;return Promise.try(function(_){var objectPath="/fr/partnering/Status/Robots/"+_this4.splitAndCamelCase(robotName,"-")+"/Parts/"+partName;_this4.request({service:"status",func:"SetPart",obj:{interface:"fr.partnering.Status.Part",path:objectPath},data:{code:code,source:1|source}},function(peerId,err,data){null!=err?"function"==typeof callback&&callback(!1):"function"==typeof callback&&callback(!0)})}).catch(function(err){Logger.error(err)})},Status.prototype.getStatus=function(robotName,partName,callback){var _this5=this,sendData=[];return Promise.try(function(_){_this5.selector.request({service:"status",func:"GetManagedObjects",obj:{interface:"org.freedesktop.DBus.ObjectManager"}},function(peerId,err,objData){var objectPathRobot="/fr/partnering/Status/Robots/"+_this5.splitAndCamelCase(robotName,"-"),objectPathPart="/fr/partnering/Status/Robots/"+_this5.splitAndCamelCase(robotName,"-")+"/Parts/"+partName,robotId=objData[objectPathRobot]["fr.partnering.Status.Robot"].RobotId;_this5.selector.request({service:"status",func:"GetPart",obj:{interface:"fr.partnering.Status.Part",path:objectPathPart}},function(peerId,err,data){sendData.push(data),_this5._getRobotModelFromRecv2(sendData,robotId,robotName),null!=err?"function"==typeof callback&&callback(-1):"function"==typeof callback&&callback(_this5.robotModel)})})}).catch(function(err){Logger.error(err)})},Status.prototype.getAllStatuses=function(robotName,callback){var _this6=this;this.selector.request({service:"status",func:"GetManagedObjects",obj:{interface:"org.freedesktop.DBus.ObjectManager"}},function(peerId,err,objData){var objectPath="/fr/partnering/Status/Robots/"+_this6.splitAndCamelCase(robotName,"-");if(null!=objData[objectPath])if(null!=objData[objectPath]["fr.partnering.Status.Robot"]){var robotId=objData[objectPath]["fr.partnering.Status.Robot"].RobotId;_this6.selector.request({service:"status",func:"GetAllParts",obj:{interface:"fr.partnering.Status.Robot",path:objectPath}},function(peerId,err,data){if(null!=err)throw"function"==typeof callback&&callback(-1),new Error(err);_this6._getRobotModelFromRecv2(data,robotId,robotName),"function"==typeof callback&&callback(_this6.robotModel)})}else Logger.error("Interface fr.partnering.Status.Robot doesn't exist!");else Logger.error("ObjectPath "+objectPath+" doesn't exist!")})},Status.prototype.splitAndCamelCase=function(inString,delimiter){var arraySplitString=inString.split(delimiter),outCamelString="";return arraySplitString.forEach(function(str){outCamelString+=str.charAt(0).toUpperCase()+str.substring(1)}),outCamelString}}()},{bluebird:void 0,util:4}]},{},[5]);
